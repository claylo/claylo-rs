<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Excalidraw Diagram Viewer</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { margin-top: 0; }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .controls {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    select, button {
      padding: 8px 16px;
      font-size: 14px;
      margin-right: 10px;
    }
    button {
      background: #1971c2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #1864ab; }
    #canvas-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      height: 700px;
    }
    .instructions {
      background: #e7f5ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .instructions ol { margin: 10px 0 0 0; padding-left: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Excalidraw Diagram Viewer</h1>

    <div class="instructions">
      <strong>To export as SVG:</strong>
      <ol>
        <li>Select a diagram below</li>
        <li>Click "Open in Excalidraw.com"</li>
        <li>Adjust styling (select all → choose style)</li>
        <li>Export → SVG → save to docs/images/</li>
      </ol>
    </div>

    <div class="controls">
      <select id="diagram-select">
        <option value="what-you-get.excalidraw">What You Get (project structure)</option>
        <option value="choose-your-adventure.excalidraw">Choose Your Adventure (flowchart)</option>
      </select>
      <button onclick="loadDiagram()">Load</button>
      <button onclick="openInExcalidraw()">Open in Excalidraw.com</button>
      <button onclick="copyJson()">Copy JSON</button>
    </div>

    <div id="canvas-container"></div>
  </div>

  <script type="module">
    import { Excalidraw, convertToExcalidrawElements } from "https://esm.sh/@excalidraw/excalidraw";
    import React from "https://esm.sh/react";
    import ReactDOM from "https://esm.sh/react-dom/client";

    let currentData = null;

    window.loadDiagram = async function() {
      const select = document.getElementById('diagram-select');
      const filename = select.value;

      try {
        const response = await fetch(filename);
        const data = await response.json();
        currentData = data;

        // Convert skeleton elements to full elements
        const elements = convertToExcalidrawElements(data.elements);

        // Render Excalidraw
        const container = document.getElementById('canvas-container');
        const root = ReactDOM.createRoot(container);

        root.render(
          React.createElement(Excalidraw, {
            initialData: {
              elements: elements,
              appState: data.appState || { viewBackgroundColor: "#ffffff" }
            },
            onChange: (newElements) => {
              currentData.elements = newElements;
            }
          })
        );
      } catch (err) {
        alert('Error loading diagram: ' + err.message);
      }
    };

    window.openInExcalidraw = function() {
      if (!currentData) {
        alert('Load a diagram first');
        return;
      }
      // Encode and open in Excalidraw
      const encoded = encodeURIComponent(JSON.stringify(currentData));
      // Excalidraw uses hash-based import
      window.open(`https://excalidraw.com/#json=${encoded}`, '_blank');
    };

    window.copyJson = function() {
      if (!currentData) {
        alert('Load a diagram first');
        return;
      }
      navigator.clipboard.writeText(JSON.stringify(currentData, null, 2))
        .then(() => alert('Copied to clipboard!'));
    };

    // Load first diagram on page load
    loadDiagram();
  </script>
</body>
</html>
